{% extends 'base.html.twig' %}

{% block title %}DataBase{% endblock %}

{% block body %}
<style>
    .example-wrapper {
        margin: 1em auto;
        max-width: 800px;
        width: 95%;
        font: 18px/1.5 sans-serif;
    }

    .example-wrapper code {
        background: #F5F5F5;
        padding: 2px 6px;
    }
</style>
<div class="d-flex flex-grow-1 m-3 overflow-hidden">
    <!-- Sidebar -->
    <nav class="h-100 col-md-5 col-lg-4 d-md-block holo header-card holo">
        <button class="bg-transparent position-absolute p-2 m-2" style="color: rgba(245, 176, 66, 0.75); border: 1px solid rgba(245, 176, 66, 0.75); border-radius: 0.25em;" onclick="window.history.back();">Retour</button>
        <span class="corner-border-top"></span>
        <div class="h-100 d-flex flex-column justify-content-between">
            <div class="w-100 px-3 overflow-auto" style="scrollbar-width: none; -ms-overflow-style: none;">
                <h1 class="text-center p-3">FACTIONS</h1>
                <a class="text-decoration-none text-light h5 my-4 d-flex"
                    data-bs-toggle="collapse"
                    href="#search"
                    role="button">
                    <i class="fa-solid fa-caret-down mx-3"></i>
                    <span>Recherche</span>
                </a>
                <div class="collapse" id="search">
                    <input type="text" name="" id="">
                </div>
                <div>
                    {% for faction in factions %}
                    <div>
                        <div>
                            <a class="text-decoration-none d-flex align-items-center justify-content-between my-3 faction-cont"
                                style="color: rgba(245, 176, 66, 0.75); border: 1px solid rgba(245, 176, 66, 0.75); border-radius: 0.25em;"
                                data-bs-toggle="collapse" 
                                href="#faction-{{ faction.id }}" 
                                role="button">
                                <div class="h-100 h2 my-4">
                                    <span class="ms-3 x-icon" style="min-width: 50px !important">{{ faction.icon }}</span>
                                    <span class="ms-5">{{ faction.name }}</span>
                                </div>
                                <i class="fa-solid fa-caret-down me-3"></i>
                            </a>
                        </div>
                    </div>
                    <div class="collapse" id="faction-{{ faction.id }}" >
                        <div class="d-flex flex-column">
                            {% for ship in ships %}
                                {% if ship.faction.id == faction.id %}
                                <a class="text-decoration-none text-light d-flex align-items-center justify-content-between my-1 ms-2"
                                    style="border: 1px solid var(--main); border-radius: 0.15em;"
                                    data-bs-toggle="collapse" 
                                    href="#ship-{{ ship.id }}" 
                                    role="button">
                                    <div class="h-75 h4 d-flex justify-content-between align-items-center">
                                        <span class="x-icon ms-4 me-5"> <img src="{{ ship.icon }}" alt="" style="width: 20%;"></span>
                                        <span>{{ ship.name }}</span>
                                    </div>
                                    <i class="fa-solid fa-caret-down me-3"></i>
                                </a>
                                <div class="collapse" id="ship-{{ ship.id }}">
                                    <div class="d-flex flex-column mb-3">
                                        {% for pilot in pilots %}
                                            {% if pilot.ship.id == ship.id %}
                                            <a class="text-decoration-none d-flex text-light justify-content-between align-items-center my-1 ms-4 pilots" id="{{ pilot.id }}"
                                                style=" background: rgb(245,176,66); background: linear-gradient(45deg, rgba(245,176,66,0.35) 5%, rgba(245,176,66, 0) 15%); color: rgba(50, 50, 50, 1); border-bottom: 1px solid rgba(245, 176, 66, 0.35); border-radius: 0.1em;"
                                                role="button">
                                                <div class="h-100 d-flex justify-content-between align-items-center">
                                                    <span class="ms-3 h-100 h4">{{ pilot.initiative }}</span>
                                                    <span class="ms-5 h-100 h5">
                                                        <div>
                                                            {% if pilot.limited > 0 %} {% for i in 1..pilot.limited %} <span class="x-icon">u</span> {% endfor %} {% endif %}
                                                            {{ pilot.name }} {% if pilot.caption != "" %} <span class="fst-italic text-secondary"> - {{ pilot.caption }} </span> {% endif %}
                                                        </div>
                                                    </span>
                                                </div>
                                                <i class="fa-solid fa-caret-right me-3"></i>
                                            </a>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <hr class="ms-2 w-75">
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Bouton import en bas -->
            <div class="d-flex flex-column align-items-center w-100 mb-3 text-center">
                <hr class="w-75">
                <button class="btn btn-danger" id="importDataBtn">Importer les données</button>
            </div>
        </div>
        <span class="corner-border-bottom"></span>
    </nav>

    <!-- Contenu principal -->
    <div class="flex-grow-1 ms-3 holo header-card">
        <span class="corner-border-top"></span>
        <div class="d-flex flex-column h-100">
            <div>
                <div id="name">Nom</div>
                <div id="caption" class="fst-italic text-secondary">Caption</div>
            </div>
            <img id="artwork" src="" alt="">
        </div>
        <span class="corner-border-bottom"></span>
    </div>
</div>


<script>

    console.log(document.getElementById('importDataBtn'))
    console.log("URL factions:", "{{ path('app_import_factions') }}");
    console.log("URL factions:", "{{ path('app_import_pilots') }}");

    document.getElementById('importDataBtn').addEventListener('click', function () {

        console.log("importation factions...")

        axios.get("{{ path('app_import_factions') }}")
            .then(response => {
                console.log('Factions importées :', response.data);
            })
            .catch(error => {
                console.error('Erreur import factions:', error);
            })
            .finally(() => {

                console.log("importation pilots...")
                axios.get("{{ path('app_import_pilots') }}")
                    .then(response => {
                        console.log('Pilotes importés :', response.data.message);
                        document.getElementById('responseMessage').innerHTML += '<br>Pilotes: ' + response.data.message;
                    })
                    .catch(error => {
                        console.error('Erreur import pilotes:', error);
                        document.getElementById('responseMessage').innerHTML += '<br>Erreur lors de l\'importation des pilotes.';
                    });
            });
    });

    const pilotsData = {{ pilots|json_encode|raw }}
    console.log(pilotsData)

    
    document.querySelectorAll(".pilots").forEach(pilotEl => {
        pilotEl.addEventListener("click", function () {
            let pilotId = pilotEl.id;

            // Trouver le pilote correspondant dans les données JSON
            let selectedPilot = pilotsData.find(pilot => pilot.id == pilotId)
            
            document.querySelector("#artwork").src = selectedPilot["image"]
        });
    });


</script>

{% endblock %}